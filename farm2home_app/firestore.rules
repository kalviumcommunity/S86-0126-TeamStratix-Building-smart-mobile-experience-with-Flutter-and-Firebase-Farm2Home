rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Allow users to manage their own user document
    match /users/{uid} {
      // Users can read their own user document
      allow read: if request.auth.uid == uid;
      // Users can create and update their own user document
      allow create, update: if request.auth.uid == uid;
      // Users can delete their own user document
      allow delete: if request.auth.uid == uid;
      
      // Allow CRUD operations on items (notes) collection
      // Path: /users/{uid}/items/{itemId}
      match /items/{itemId} {
        // Users can only read their own items
        allow read: if request.auth.uid == uid;
        
        // Users can create new items (notes)
        allow create: if 
          request.auth.uid == uid &&
          request.resource.data.uid == uid;
        
        // Users can only update their own items
        allow update: if request.auth.uid == uid;
        
        // Users can only delete their own items
        allow delete: if request.auth.uid == uid;
      }
    }
  }
}
